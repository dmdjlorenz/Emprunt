<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculatrice d'Emprunt Immobilier</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 10px;
            background-color: #f4f4f4;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }
        .sliders {
            width: 100%;
            max-width: 400px;
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .slider-container, .input-container {
            margin-bottom: 15px;
        }
        label {
            display: block;
            font-size: 16px;
            margin-bottom: 5px;
        }
        input[type="range"] {
            width: 100%;
        }
        input[type="number"] {
            width: 100px;
            padding: 5px;
            font-size: 14px;
            margin-left: 10px;
        }
        .lock-btn {
            margin-top: 5px;
            padding: 5px 10px;
            font-size: 14px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
        }
        .lock-btn.locked {
            background-color: #dc3545;
        }
        .results {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="sliders">
        <h1 style="text-align: center;">Calculatrice d'Emprunt</h1>

        <div class="slider-container">
            <label>Taux d'intérêt (%): <span id="interestValue">2.00</span></label>
            <input type="range" id="interest" min="0" max="10" step="0.01" value="2">
            <button class="lock-btn" onclick="lockSlider('interest')">Bloquer</button>
        </div>

        <div class="input-container">
            <label>Taux d'assurance (%): 
                <input type="number" id="insurance" min="0" max="10" step="0.01" value="0.36">
            </label>
        </div>

        <div class="slider-container">
            <label>Montant de l'emprunt: <span id="amountValue">100000 €</span></label>
            <input type="range" id="amount" min="0" max="2000000" step="1000" value="100000">
            <button class="lock-btn" onclick="lockSlider('amount')">Bloquer</button>
        </div>

        <div class="slider-container">
            <label>Durée (ans): <span id="yearsValue">15</span></label>
            <input type="range" id="years" min="0" max="25" step="1" value="15">
            <button class="lock-btn" onclick="lockSlider('years')">Bloquer</button>
        </div>

        <div class="slider-container">
            <label>Mensualité: <span id="monthlyValue">0 €</span></label>
            <input type="range" id="monthly" min="0" max="50000" step="10" value="0">
            <button class="lock-btn" onclick="lockSlider('monthly')">Bloquer</button>
        </div>

        <div class="results">
            <div>Coût de l'emprunt: <span id="interestCost">0</span> €</div>
            <div>Coût total du crédit: <span id="totalCost">0</span> €</div>
        </div>
    </div>

    <script>
        const sliders = {
            interest: { id: 'interest', valueId: 'interestValue', locked: false },
            amount: { id: 'amount', valueId: 'amountValue', locked: false },
            years: { id: 'years', valueId: 'yearsValue', locked: false },
            monthly: { id: 'monthly', valueId: 'monthlyValue', locked: false }
        };

        function lockSlider(sliderId) {
            sliders[sliderId].locked = !sliders[sliderId].locked;
            const btn = document.querySelector(`#${sliders[sliderId].id} + .lock-btn`);
            btn.textContent = sliders[sliderId].locked ? 'Débloquer' : 'Bloquer';
            btn.classList.toggle('locked');
            updateCalculations(sliderId);
        }

        function getSliderValues() {
            return {
                interest: parseFloat(document.getElementById('interest').value),
                insurance: parseFloat(document.getElementById('insurance').value),
                amount: parseInt(document.getElementById('amount').value),
                years: parseInt(document.getElementById('years').value),
                monthly: parseInt(document.getElementById('monthly').value)
            };
        }

        function calculateMonthlyPayment(amount, rate, insuranceRate, years) {
            if (years === 0) return 0;
            const monthlyRate = rate / 100 / 12;
            const totalPayments = years * 12;
            const loanPayment = rate === 0 ? amount / totalPayments : (amount * monthlyRate) / (1 - Math.pow(1 + monthlyRate, -totalPayments));
            const insurancePayment = (amount * insuranceRate / 100) / 12;
            return Math.round(loanPayment + insurancePayment);
        }

        function calculateBorrowingCost(values) {
            const totalPayments = values.monthly * values.years * 12;
            const insuranceCost = values.amount * (values.insurance / 100) * values.years;
            const interestCost = totalPayments - values.amount - insuranceCost;
            return { interestCost: Math.round(interestCost), totalCost: Math.round(totalPayments) };
        }

        function updateCalculations(changedSlider) {
            const values = getSliderValues();

            // Affichage des valeurs sliders
            if (changedSlider === 'interest') {
                document.getElementById('interestValue').textContent = values.interest.toFixed(2);
            } else if (changedSlider === 'amount') {
                document.getElementById('amountValue').textContent = values.amount + " €";
            } else if (changedSlider === 'years') {
                document.getElementById('yearsValue').textContent = values.years;
            } else if (changedSlider === 'monthly') {
                document.getElementById('monthlyValue').textContent = values.monthly + " €";
            }

            if (!sliders.monthly.locked) {
                values.monthly = calculateMonthlyPayment(values.amount, values.interest, values.insurance, values.years);
                document.getElementById('monthly').value = values.monthly;
                document.getElementById('monthlyValue').textContent = values.monthly + " €";
            }

            const costs = calculateBorrowingCost(values);
            document.getElementById('interestCost').textContent = costs.interestCost;
            document.getElementById('totalCost').textContent = costs.totalCost;
        }

        // Ajout des écouteurs pour chaque slider
        Object.keys(sliders).forEach(key => {
            document.getElementById(key).addEventListener('input', () => updateCalculations(key));
        });

        // ✅ Correction principale : écouteur sur le champ d'assurance
        document.getElementById('insurance').addEventListener('input', () => updateCalculations('insurance'));

        // Initialisation
        updateCalculations('amount');
    </script>
</body>
</html>
